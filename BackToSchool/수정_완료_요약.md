# 수정 완료 요약

## ✅ 수정된 문제들

### 1. 텍스트 이펙트가 각 대사마다 개별 적용되도록 수정

**문제:**
- 텍스트 이펙트가 대화 전체에 적용되는 것처럼 보였음

**해결:**
- 각 대사가 시작될 때 이전 이펙트 코루틴을 중지
- 각 대사가 끝나면 이펙트 코루틴을 중지하고 텍스트를 원래 상태로 복원
- 이제 각 DialogueLine의 `textEffect` 설정이 해당 대사에만 적용됩니다

**사용 방법:**
- CSV에서 대화 작성 후, 코드에서 각 DialogueLine의 `textEffect` 설정
- 예: `lines[0].textEffect = TextEffectType.Shake;`

---

### 2. 선택지가 대화 중간에도 나올 수 있도록 수정

**문제:**
- 선택지가 대화 마지막에만 나옴

**해결:**
- 각 DialogueLine마다 `hasChoices`와 `choices` 설정 가능
- 대화 중간의 어떤 대사에도 선택지를 넣을 수 있음

**사용 방법 (DialogueTrigger에서):**
```
Contextual Dialogue 설정:
- Choice Line Index: 1 (2번째 대사에 선택지 넣기, -1이면 마지막)
- Choices: 선택지 목록 추가
```

**사용 방법 (코드에서):**
```csharp
List<DialogueLine> lines = LocalizationManager.Instance.GetConversation("CONVO_ID");
lines[1].hasChoices = true; // 2번째 대사에 선택지
lines[1].choices.Add(new DialogueChoice { ... });
```

---

### 3. DialogueTrigger에서 선택지 설정 가능하도록 수정

**문제:**
- 선택지 설정이 DialogueManager에만 있어서 DialogueTrigger에서 설정 불가

**해결:**
- ContextualDialogue에 선택지 설정 필드 추가
  - `choiceLineIndex`: 몇 번째 대사에 선택지를 넣을지 (0부터 시작, -1이면 마지막)
  - `choices`: 선택지 목록 (최대 4개)
- DialogueTrigger에서 대화 시작 전에 선택지를 자동으로 추가

**사용 방법:**
1. NPC GameObject 선택
2. DialogueTrigger 컴포넌트 확인
3. Contextual Dialogues → Element 0 선택
4. Choice Line Index 설정 (예: 1 = 2번째 대사, -1 = 마지막 대사)
5. Choices 리스트에 선택지 추가:
   - Choice Text ID: "LINE_CHOICE_1"
   - Next Conversation ID: "RESPONSE_1"
   - Scene To Load: (선택사항)
   - State To Change: (선택사항)

---

## 📝 사용 예시

### 예시 1: 대화 중간에 선택지 넣기

**CSV (Conversations.csv):**
```
CONVO_TEST,1,NAME_NPC,LINE_QUESTION
CONVO_TEST,2,NAME_PLAYER,LINE_RESPONSE
CONVO_TEST,3,NAME_NPC,LINE_END
```

**Unity Inspector (DialogueTrigger):**
```
Contextual Dialogues → Element 0:
- Conversation ID: "CONVO_TEST"
- Choice Line Index: 0 (첫 번째 대사 후 선택지)
- Choices:
  - Choice 0:
    - Choice Text ID: "LINE_CHOICE_YES"
    - Next Conversation ID: "CONVO_YES"
  - Choice 1:
    - Choice Text ID: "LINE_CHOICE_NO"
    - Next Conversation ID: "CONVO_NO"
```

**결과:**
- NPC: "질문" (LINE_QUESTION)
- 선택지 표시:
  - "예" (LINE_CHOICE_YES) → CONVO_YES 대화로
  - "아니오" (LINE_CHOICE_NO) → CONVO_NO 대화로

---

### 예시 2: 텍스트 이펙트 적용

**코드:**
```csharp
List<DialogueLine> lines = LocalizationManager.Instance.GetConversation("SCARY_CONVO");
lines[0].textEffect = TextEffectType.Shake; // 첫 번째 대사에 Shake 효과
lines[0].effectIntensity = 0.7f;
```

**결과:**
- 첫 번째 대사만 Shake 효과
- 나머지 대사는 일반 텍스트

---

### 예시 3: 대화 중간에 애니메이션 + 이펙트

**코드:**
```csharp
List<DialogueLine> lines = LocalizationManager.Instance.GetConversation("EXCITED_CONVO");
lines[1].animationTrigger = "Happy"; // 2번째 대사 시작 시 Happy 애니메이션
lines[1].textEffect = TextEffectType.Bounce; // Bounce 효과
lines[1].effectIntensity = 0.8f;
```

**결과:**
- 2번째 대사 시작 시 캐릭터가 Happy 애니메이션 재생
- 2번째 대사에 Bounce 텍스트 이펙트 적용

---

## 🔧 주요 변경 사항

### DialogueManager.cs
- 텍스트 이펙트가 각 대사마다 개별 적용되도록 수정
- 각 대사 종료 시 이펙트 코루틴 중지 및 텍스트 복원

### DialogueTrigger.cs
- ContextualDialogue에 선택지 설정 필드 추가
- 대화 시작 전 선택지를 자동으로 추가하는 기능 구현

---

## ✅ 확인 사항

1. **텍스트 이펙트:** 각 대사마다 개별 적용 ✅
2. **선택지:** 대화 중간에도 가능 ✅
3. **DialogueTrigger:** Inspector에서 선택지 설정 가능 ✅

이제 Unity에서 테스트해보세요! 🎉




