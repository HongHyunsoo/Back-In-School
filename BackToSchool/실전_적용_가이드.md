# 🎮 Unity 대화 시스템 실전 적용 가이드

## 📌 빠른 시작 (5분 안에 적용하기)

### Step 1: 기본 UI 만들기 (2분)

1. **Canvas 생성**
   ```
   Hierarchy 우클릭 → UI → Canvas
   ```

2. **대화 말풍선 만들기**
   ```
   Canvas 우클릭 → UI → Panel
   이름 변경: "DialogueBubble"
   - RectTransform 크기: 600x200
   - 색상: 검은색 반투명 (Alpha 200 정도)
   
   DialogueBubble 자식으로:
   - TextMeshProUGUI 추가 → "NameText" (이름 표시)
   - TextMeshProUGUI 추가 → "DialogueText" (대사 표시)
   ```

3. **선택지 패널 만들기**
   ```
   Canvas 우클릭 → UI → Panel
   이름 변경: "ChoicePanel"
   
   ChoicePanel 자식으로:
   - Button 4개 생성 (ChoiceButton1~4)
   - 각 버튼에 TextMeshProUGUI 추가
   - Image 추가 → "ChoiceArrow" (화살표)
   ```

4. **처음에는 모두 비활성화**
   - DialogueBubble 체크 해제
   - ChoicePanel 체크 해제

### Step 2: DialogueManager 설정 (1분)

1. **DialogueManager 오브젝트 만들기**
   ```
   Hierarchy 우클릭 → Create Empty
   이름: "DialogueManager"
   Add Component → DialogueManager
   Add Component → Audio Source
   ```

2. **Inspector에서 연결하기**
   - Speech Bubble Object → DialogueBubble 드래그
   - Name Text → NameText 드래그
   - Dialogue Text → DialogueText 드래그
   - Choice Panel → ChoicePanel 드래그
   - Choice Buttons 배열 → ChoiceButton1~4 드래그
   - Choice Texts 배열 → 각 버튼의 TextMeshProUGUI 드래그
   - Choice Arrow → ChoiceArrow 드래그
   - Audio Source → 같은 오브젝트의 AudioSource 드래그
   - Player Controller → Player의 PlayerController 드래그

### Step 3: LocalizationManager 설정 (30초)

1. **LocalizationManager 오브젝트 만들기**
   ```
   Hierarchy 우클릭 → Create Empty
   이름: "LocalizationManager"
   Add Component → LocalizationManager
   ```

2. **끝!** (CSV는 이미 만들어져 있음)

### Step 4: 테스트용 NPC 만들기 (1분)

1. **NPC 만들기**
   ```
   Hierarchy 우클릭 → 2D Object → Sprite
   이름: "TestNPC"
   ```

2. **컴포넌트 추가**
   ```
   Add Component → CharacterIdentifier
   - Character ID: "TEST_NPC"
   
   Add Component → Box Collider 2D
   - Is Trigger: ✅ 체크
   - Size: (2, 2)
   
   Add Component → DialogueTrigger
   - Default Conversation ID: "TEST_CONVO"
   ```

3. **Contextual Dialogues 설정**
   - Contextual Dialogues 리스트 크기: 1
   - Element 0:
     - Day: 1
     - Specific State: Lunch_FreeTime
     - Behavior: Repeatable
     - Conversation ID: "TEST_CONVO"

### Step 5: CSV에 테스트 대화 추가 (30초)

**Assets/Resources/Localization.csv** 열기:
```
ID,KOR,ENG
NAME_PLAYER,로봇,Robot
NAME_TEST_NPC,테스트NPC,TestNPC
LINE_TEST_01,안녕! 만나서 반가워,Hello! Nice to meet you
LINE_TEST_02,뭐하고 있었어?,What were you doing?
```

**Assets/Resources/Conversations.csv** 열기:
```
Conversation_ID,Order,Speaker_ID,Line_ID
TEST_CONVO,1,NAME_TEST_NPC,LINE_TEST_01
TEST_CONVO,2,NAME_PLAYER,LINE_TEST_02
```

### Step 6: 테스트!

1. **Play 버튼 누르기**
2. **Player를 NPC에게 이동**
3. **E키 누르기**
4. **대화가 나오는지 확인!** ✅

---

## 🎯 실제 사용 예시

### 예시 1: 선택지가 있는 대화

**Localization.csv:**
```
LINE_QUESTION,점심 뭐 먹을까?,What should we eat for lunch?
LINE_CHOICE_RICE,밥,Rice
LINE_CHOICE_BREAD,빵,Bread
LINE_RESPONSE_RICE,밥 좋아!,Rice is good!
LINE_RESPONSE_BREAD,빵 좋아!,Bread is good!
```

**Conversations.csv:**
```
CHOICE_LUNCH,1,NAME_NPC,LINE_QUESTION
CHOICE_LUNCH_RICE,1,NAME_PLAYER,LINE_RESPONSE_RICE
CHOICE_LUNCH_BREAD,1,NAME_PLAYER,LINE_RESPONSE_BREAD
```

**⚠️ 문제:** CSV만으로는 선택지를 연결할 수 없음!

**✅ 해결 방법:**

1. **DialogueDataEditor 사용** (권장)
   - Hierarchy에 DialogueDataEditor 오브젝트 추가
   - Inspector에서 대화 작성 (선택지 포함)
   - "Save to CSV" 버튼 클릭

2. **코드에서 직접 설정**
   ```csharp
   // DialogueManager에서 대화 시작 전에
   List<DialogueLine> lines = LocalizationManager.Instance.GetConversation("CHOICE_LUNCH");
   if (lines.Count > 0)
   {
       DialogueLine lastLine = lines[lines.Count - 1];
       lastLine.hasChoices = true;
       lastLine.choices.Add(new DialogueChoice
       {
           choiceTextID = "LINE_CHOICE_RICE",
           nextConversationID = "CHOICE_LUNCH_RICE"
       });
       lastLine.choices.Add(new DialogueChoice
       {
           choiceTextID = "LINE_CHOICE_BREAD",
           nextConversationID = "CHOICE_LUNCH_BREAD"
       });
   }
   ```

### 예시 2: 애니메이션이 있는 대화

**NPC Animator Controller 설정:**
1. Animator Controller 만들기
2. 파라미터 추가: Trigger 타입, 이름 "Talk"
3. 애니메이션 상태 추가 및 트리거 연결

**Conversations.csv:**
```
TALK_CONVO,1,NAME_NPC,LINE_TALK_01
```

**⚠️ 문제:** CSV만으로는 애니메이션 트리거를 설정할 수 없음!

**✅ 해결 방법:**

1. **DialogueDataEditor 사용**
   - Animation Trigger 필드에 "Talk" 입력

2. **코드에서 설정**
   ```csharp
   List<DialogueLine> lines = LocalizationManager.Instance.GetConversation("TALK_CONVO");
   if (lines.Count > 0)
   {
       lines[0].animationTrigger = "Talk";
   }
   ```

### 예시 3: 텍스트 이펙트가 있는 대화

**Conversations.csv:**
```
SHAKE_CONVO,1,NAME_NPC,LINE_SCARY_01
```

**✅ 해결 방법:**

1. **DialogueDataEditor 사용**
   - Text Effect: Shake 선택
   - Effect Intensity: 0.7 입력

2. **코드에서 설정**
   ```csharp
   List<DialogueLine> lines = LocalizationManager.Instance.GetConversation("SHAKE_CONVO");
   if (lines.Count > 0)
   {
       lines[0].textEffect = TextEffectType.Shake;
       lines[0].effectIntensity = 0.7f;
   }
   ```

---

## 🔧 LocalizationManager 수정 (에디터 데이터 지원)

현재 LocalizationManager는 CSV만 읽습니다.
DialogueDataEditor의 데이터도 사용하려면 수정이 필요합니다.

**수정 방법:**

1. **DialogueDataEditor 오브젝트를 Scene에 추가**
2. **LocalizationManager 수정** (선택사항)

또는 **CSV만 사용**하고,
**고급 기능(선택지/애니메이션/이펙트)은 코드에서 추가**

---

## 📝 대화 작성 팁

### 1. ID 명명 규칙
```
CONVERSATION_DAY1_NPC_LUNCH
- CONVERSATION: 대화임을 표시
- DAY1: 1일차
- NPC: NPC 이름
- LUNCH: 상황 (점심)
```

### 2. 대사 작성 팁
- 짧고 명확하게
- 캐릭터 성격에 맞게
- 언어별로 자연스럽게 번역

### 3. 선택지 작성
- 최대 4개
- 각 선택지마다 다른 결과
- 명확한 선택지 텍스트

---

## 🐛 자주 발생하는 문제

### 문제 1: 대화가 안 나와요
**해결:**
- DialogueManager의 UI 요소들이 모두 연결되었는지 확인
- CSV 파일이 Resources 폴더에 있는지 확인
- Conversation ID가 정확한지 확인
- Console 에러 확인

### 문제 2: 선택지가 안 보여요
**해결:**
- ChoicePanel이 활성화되어 있는지 확인
- ChoiceButtons 배열이 올바르게 설정되었는지 확인
- DialogueLine의 hasChoices가 true인지 확인

### 문제 3: 애니메이션이 안 나와요
**해결:**
- NPC에 Animator 컴포넌트가 있는지 확인
- Animator Controller가 할당되었는지 확인
- 트리거 이름이 정확한지 확인
- DialogueLine의 animationTrigger가 설정되었는지 확인

### 문제 4: 텍스트 이펙트가 안 나와요
**해결:**
- DialogueText가 TextMeshProUGUI인지 확인
- TextEffect가 None이 아닌지 확인
- EffectIntensity가 0보다 큰지 확인

---

## 🚀 다음 단계

1. **대화 데이터 작성**
   - 게임에 필요한 모든 대화 작성
   - CSV 파일로 관리

2. **NPC 설정**
   - 각 NPC에 DialogueTrigger 추가
   - 상황별 대화 설정

3. **스토리 대화 설정**
   - GameManager의 ChangeState에서 대화 시작
   - 각 상태별 대화 연결

4. **테스트 및 조정**
   - 모든 대화 테스트
   - 애니메이션/이펙트 조정
   - 선택지 분기 확인

---

## 💡 추가 기능 추가하기

### 언어 전환 기능
1. PhoneManager 설정 (이미 구현됨)
2. 폰 UI에 언어 버튼 추가
3. 테스트

### 소리 이펙트
1. Resources/Sounds 폴더 만들기
2. 오디오 파일 추가
3. DialogueLine의 soundEffectName 설정

---

이제 실제로 Unity에서 설정해보세요! 🎉




